var E=$.noConflict(!0);E(document).ready(function(){var i=document.editor=CodeMirror.fromTextArea(htmlcode,{mode:"htmlmixed",profile:"html",keyMap:"sublime",lineNumbers:!0,lineWrapping:!1,theme:"dracula",tabSize:4,indentUnit:4,extraKeys:{Tab:"indentMore"},foldGutter:!0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],matchTags:{bothTags:!0},matchBrackets:!1,autoCloseTags:!0,autoCloseBrackets:!0,scrollbarStyle:"overlay",styleActiveLine:!0,showTrailingSpace:!0,lint:!1}),o=document.editor=CodeMirror.fromTextArea(csscode,{mode:"css",profile:"css",keyMap:"sublime",lineNumbers:!0,lineWrapping:!1,theme:"dracula",tabSize:4,indentUnit:4,extraKeys:{Tab:"indentMore"},foldGutter:!0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:!0,autoCloseBrackets:!0,scrollbarStyle:"overlay",styleActiveLine:!0,showTrailingSpace:!0,lint:!1}),n=document.editor=CodeMirror.fromTextArea(jscode,{mode:"javascript",keyMap:"sublime",lineNumbers:!0,lineWrapping:!1,theme:"dracula",tabSize:4,indentUnit:4,extraKeys:{Tab:"indentMore"},foldGutter:!0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:!0,autoCloseBrackets:!0,scrollbarStyle:"overlay",styleActiveLine:!0,showTrailingSpace:!0,lint:!1}),e=E(".font-size input");function t(e,t){e.getWrapperElement().style["font-size"]=t+"%",e.refresh()}var s,a,l=document.getElementById("preview");function r(){var e=E("#preview").contents().find("body"),t=i.getValue();e.html(t),c()}function c(){var e=E("#preview").contents().find("head"),t=o.getValue();e.html('<link rel="stylesheet" href="./css/reset.css"><style>'+t+"</style>")}s=l.contentDocument||(l.contentWindow||l).document,a=i.getValue(),s.open(),s.write(a),s.close(),c();var d,p='<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"><\/script>\n<main>\n    <h1>Editor</h1>\n    <p>Real-time, responsive HTML/CSS/JS code editor</p>\n    <p>Fork me on <a href="https://github.com/markhillard/Editor" target="_blank">GitHub</a></p>\n</main>',h='@import url("https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap");\n\nhtml,body {\n    background-color: #282a36;\n    color: #fff;\n    font-family: "Fira Code", monospace;\n    font-weight: 400;\n    overflow: hidden;\n    text-align: center;\n}\n\nmain {\n    left: 50%;\n    position: absolute;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 80%;\n}\n\nh1 {\n    font-size: 8rem;\n    font-weight: 700;\n    margin: 0;\n}\n\np {\n    font-size: 1rem;\n    letter-spacing: .03rem;\n    line-height: 1.45;\n    margin: 1rem 0;\n}\n\na {\n    color: #6d8a88;\n}\n\n@media only screen and (max-width: 600px) {\n    h1 {\n        font-size: 4rem;\n    }\n}',f="$(document).ready(function () {\n    $('h1').fadeOut(800).fadeIn(800);\n    $('p').first().delay(400).fadeOut(800).fadeIn(400);\n    $('p').last().delay(800).fadeOut(800).fadeIn(400);\n});";null===localStorage.getItem("htmlcode")&&localStorage.setItem("htmlcode",p),null===localStorage.getItem("csscode")&&localStorage.setItem("csscode",h),null===localStorage.getItem("jscode")&&localStorage.setItem("jscode",f),null===localStorage.getItem("fontsize")&&localStorage.setItem("fontsize","100"),i.setValue(localStorage.getItem("htmlcode")),o.setValue(localStorage.getItem("csscode")),n.setValue(localStorage.getItem("jscode")),e.val(localStorage.getItem("fontsize")),i.on("change",function(){x&&(clearTimeout(d),d=setTimeout(r,1e3)),localStorage.setItem("htmlcode",i.getValue())}),o.on("change",function(){x&&c(),localStorage.setItem("csscode",o.getValue())}),n.on("change",function(){localStorage.setItem("jscode",n.getValue())}),t(i,e.val()),t(o,e.val()),t(n,e.val()),r();var g=E(".cdnjs-search .query");function m(){g.typeahead("val",""),g.typeahead("close")}E.get("https://api.cdnjs.com/libraries?fields=version,description").done(function(e){e=e.results,e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:e});g.typeahead(null,{display:"name",name:"search",source:e,limit:1/0,templates:{empty:function(){return'<p class="no-match">unable to match query!</p>'},suggestion:function(e){return'<p class="lib"><span class="name">'+e.name+'</span> <span class="version">'+e.version+'</span><br><span class="description">'+e.description+"</span></p>"}}}).on("typeahead:select",function(e,t){var n,s,t=t.latest;function a(e,t){e.replaceRange(n+"\n",{line:t,ch:0})}-1!==(t=t).indexOf("<")?n=t:t.endsWith(".js")?n='<script src="'+t+'"><\/script>':t.endsWith(".css")&&(n='@import url("'+t+'");'),-1!==i.getValue().indexOf(n)||-1!==o.getValue().indexOf(n)?alert("dependency already included!"):(t.endsWith(".js")?(s=i.getValue().split("<\/script>").length-1,a(i,s),E(".code-swap-html").click()):t.endsWith(".css")&&(s=o.getValue().split("@import").length-1,a(o,s),E(".code-swap-css").click()),alert("dependency added successfully!")),m()}).on("typeahead:change",function(){m()})}).fail(function(){alert("error getting cdnjs libraries!")});var u=E(".code-pane"),w=E(".preview-width"),v=E(window).width();function y(e){e.css({position:"relative",visibility:"visible"})}function C(e){e.css({position:"absolute",visibility:"hidden"})}u.resizable({handles:"e",minWidth:0,maxWidth:v-16,create:function(){var e=u.width(),e=v-e-16;w.text(e+"px")},resize:function(e,t){var n=t.size.width,s=v-n-16;t.element.next().css("width",v-n+"px"),t.element.next().find("iframe").css("pointer-events","none"),w.show(),n<=0?w.text(v-16+"px"):w.text(s+"px")},stop:function(e,t){t.element.next().find("iframe").css("pointer-events","inherit"),w.hide(),i.refresh(),o.refresh(),n.refresh()}}),E(".code-swap span").not(".toggle-view").on("click",function(){var e=E(".code-pane-html"),t=E(".code-pane-css"),n=E(".code-pane-js"),s=E(".toggle-lineWrapping.html"),a=E(".toggle-lineWrapping.css"),i=E(".toggle-lineWrapping.js"),o=E(".preview-pane");E(this).addClass("active").siblings().removeClass("active"),E(this).is(':contains("HTML")')?(y(e),y(s),C(t),C(a),C(n),C(i),(E(window).width()<=800?C:y)(o)):E(this).is(':contains("CSS")')?(y(t),y(a),C(e),C(s),C(n),C(i),(E(window).width()<=800?C:y)(o)):E(this).is(':contains("JS")')?(y(n),y(i),C(e),C(s),C(t),C(a),(E(window).width()<=800?C:y)(o)):E(this).is(':contains("preview")')&&(y(o),C(e),C(s),C(t),C(a),C(n),C(i))});var b=E(".CodeMirror-overlayscroll-vertical"),k=E(".CodeMirror-overlayscroll-horizontal");function S(e){var s=e.defaultCharWidth();e.on("renderLine",function(e,t,n){e=CodeMirror.countColumn(t.text,null,e.getOption("tabSize"))*s;n.style.textIndent="-"+e+"px",n.style.paddingLeft=4+e+"px"})}b.on("mousedown",function(){E(this).addClass("hold")}),k.on("mousedown",function(){E(this).addClass("hold")}),E(document).on("mouseup",function(){b.removeClass("hold"),k.removeClass("hold")}),S(i),S(o),S(n),e.on("change keyup",function(){var e=E(this).val();t(i,e),t(o,e),t(n,e),localStorage.setItem("fontsize",e)}),E(".toggle-view").on("click",function(){E(this).toggleClass("enabled"),E(this).hasClass("enabled")?E(this).html('view<span class="fa-solid fa-fw fa-chevron-up"></span>'):E(this).html('view<span class="fa-solid fa-fw fa-chevron-down"></span>')}),E(".toggle-tools").on("click",function(){E(this).toggleClass("active"),E(this).hasClass("active")?E(this).html('tools<span class="fa-solid fa-fw fa-chevron-up"></span>'):E(this).html('tools<span class="fa-solid fa-fw fa-chevron-down"></span>')}),E(".toggle-lineWrapping.html").on("click",function(){E(this).toggleClass("active"),E(this).hasClass("active")?(i.setOption("lineWrapping",!0),E(this).html('wrap<span class="fa-solid fa-fw fa-toggle-on"></span>')):(i.setOption("lineWrapping",!1),E(this).html('wrap<span class="fa-solid fa-fw fa-toggle-off"></span>'))}),E(".toggle-lineWrapping.css").on("click",function(){E(this).toggleClass("active"),E(this).hasClass("active")?(o.setOption("lineWrapping",!0),E(this).html('wrap<span class="fa-solid fa-fw fa-toggle-on"></span>')):(o.setOption("lineWrapping",!1),E(this).html('wrap<span class="fa-solid fa-fw fa-toggle-off"></span>'))}),E(".toggle-lineWrapping.js").on("click",function(){E(this).toggleClass("active"),E(this).hasClass("active")?(n.setOption("lineWrapping",!0),E(this).html('wrap<span class="fa-solid fa-fw fa-toggle-on"></span>')):(n.setOption("lineWrapping",!1),E(this).html('wrap<span class="fa-solid fa-fw fa-toggle-off"></span>'))}),E(".toggle-emmet").on("click",function(){E(this).toggleClass("active"),E(this).hasClass("active")?(emmetCodeMirror(i),emmetCodeMirror(o),E(this).html('emmet<span class="fa-solid fa-fw fa-toggle-on"></span>')):(emmetCodeMirror.dispose(i),emmetCodeMirror.dispose(o),E(this).html('emmet<span class="fa-solid fa-fw fa-toggle-off"></span>'))}),E(".toggle-lint").on("click",function(){E(this).toggleClass("active"),E(this).hasClass("active")?(i.setOption("lint",!0),o.setOption("lint",!0),n.setOption("lint",!0),E(this).html('lint<span class="fa-solid fa-fw fa-toggle-on"></span>')):(i.setOption("lint",!1),o.setOption("lint",!1),n.setOption("lint",!1),E(this).html('lint<span class="fa-solid fa-fw fa-toggle-off"></span>'))});var x=!0;E(".toggle-watch").on("click",function(){E(this).toggleClass("active"),E(this).hasClass("active")?(x=!0,r(),c(),E(this).html('watch<span class="fa-solid fa-fw fa-toggle-on"></span>')):(x=!1,E(this).html('watch<span class="fa-solid fa-fw fa-toggle-off"></span>'))}),E(".reset-editor").on("click",function(){i.setValue(p),o.setValue(h),n.setValue(f)}),E(".refresh-editor").on("click",function(){location.reload()}),E(".clear-editor").on("click",function(){i.setValue(""),o.setValue(""),n.setValue("")}),E(".run-script").on("click",function(){var e,t;e=i.getValue(),t=n.getValue(),s.open(),s.write(e+"<script>"+t+"<\/script>"),s.close(),c(),r(),E(window).width()<=800&&E(".toggle-preview").click()}),E(".save").on("click",function(){var e='<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<meta name="viewport" content="width=device-width, initial-scale=1">\n<link rel="stylesheet" href="https://rawgit.com/markhillard/Editor/gh-pages/css/reset.css">\n<style>\n'+o.getValue()+"\n</style>\n</head>\n<body>\n"+i.getValue()+"\n<script>\n"+n.getValue()+"\n<\/script>\n</body>\n</html>\n",e=new Blob([e],{type:"text/html; charset=utf-8"});saveAs(e,"editor.html")}),i.refresh(),o.refresh(),n.refresh()});
